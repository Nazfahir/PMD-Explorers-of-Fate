<form class="{{cssClass}} my-sheet" autocomplete="off">
  <!-- ===== Encabezado ===== -->
  <header class="sheet-header flexrow">
    <div class="header-fields">
      <label>Nombre</label>
      <input type="text" name="name" value="{{actor.name}}" />

      <div class="grid two-col">
        <div>
          <label>Nivel</label>
          <input type="number" name="system.lvl" value="{{system.lvl}}" data-dtype="Number"/>
        </div>
        <div>
          <label>Pasiva</label>
          <input type="text" name="system.pasiva" value="{{system.pasiva}}" />
        </div>
        <div>
          <label>Destino</label>
          <input type="text" name="system.destino" value="{{system.destino}}" />
        </div>
        <div>
          <label>Leyenda</label>
          <input type="text" name="system.leyenda" value="{{system.leyenda}}" />
        </div>
        <div>
          <label>Background</label>
          <input type="text" name="system.background" value="{{system.background}}" />
        </div>
        <div>
          <label>Velocidad</label>
          <input type="number" name="system.speed" value="{{system.speed}}" data-dtype="Number"/>
        </div>

        <!-- Nuevos campos: Tipo 1 y Tipo 2 -->
        <div>
          <label>Tipo 1</label>
          <input type="text" name="system.type1" value="{{system.type1}}"/>
        </div>
        <div>
          <label>Tipo 2</label>
          <input type="text" name="system.type2" value="{{system.type2}}"/>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== Tabs ===== -->
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="stats">Atributos</a>
    <a class="item" data-tab="skills">Habilidades</a>
    <a class="item" data-tab="moves">Movimientos</a>
    <a class="item" data-tab="traits">Rasgos</a>
    <a class="item" data-tab="inventory">Objetos</a>
  </nav>

  <section class="sheet-body">
    <!-- ===== TAB: Atributos ===== -->
    <div class="tab" data-tab="stats" data-group="primary">
      <div class="grid two-col">
        <div class="stat">
          <label>HP Actual</label>
          <input type="number" name="system.hp.value" value="{{system.hp.value}}" data-dtype="Number"/>
        </div>
        <div class="stat">
          <label>HP Máxima</label>
          <input type="number" name="system.hp.max" value="{{system.hp.max}}" data-dtype="Number"/>
        </div>

        <div class="stat">
          <label>EXP Actual</label>
          <input type="number" name="system.experience.value" value="{{system.experience.value}}" data-dtype="Number"/>
        </div>
        <div class="stat">
          <label>EXP Máxima</label>
          <input type="number" name="system.experience.max" value="{{system.experience.max}}" data-dtype="Number" readonly/>
        </div>

        <div class="stat restore-resources full-width">
          <button type="button" data-action="restore-actor">Restaurar HP y PP</button>
        </div>

        <div class="stat">
          <label>Attack</label>
          <input type="number" name="system.attack" value="{{system.attack}}" data-dtype="Number"/>
        </div>
        <div class="stat">
          <label>Sp. Attack</label>
          <input type="number" name="system.spAttack" value="{{system.spAttack}}" data-dtype="Number"/>
        </div>

        <div class="stat">
          <label>Defense</label>
          <input type="number" name="system.defense" value="{{system.defense}}" data-dtype="Number"/>
        </div>
        <div class="stat">
          <label>Sp. Defense</label>
          <input type="number" name="system.spDefense" value="{{system.spDefense}}" data-dtype="Number"/>
        </div>

        <div class="stat">
          <label>STAB</label>
          <input type="number" name="system.stab" value="{{system.stab}}" data-dtype="Number"/>
        </div>
        <div class="stat">
          <label>Basic Attack</label>
          <input type="number" name="system.basicattack" value="{{system.basicattack}}" data-dtype="Number"/>
        </div>

        <div class="stat">
          <label>LP</label>
          <input type="number" name="system.lp" value="{{system.lp}}" data-dtype="Number"/>
        </div>

        <div class="stat">
          <label>Belly</label>
          <input type="number" name="system.belly" value="{{system.belly}}" data-dtype="Number"/>
        </div>
      </div>
    </div>

    <!-- ===== TAB: Habilidades ===== -->
    <div class="tab" data-tab="skills" data-group="primary">
      <div class="grid three-col">
        {{#each skillList}}
          <div class="stat">
            <!-- Nombre clicable para tirar -->
            <label class="skill-label">
              <button type="button"
                      class="as-link"
                      data-action="roll-skill"
                      data-skill="{{key}}"
                      data-label="{{label}}">
                {{label}}
              </button>
            </label>
            <input
              type="number"
              name="system.skills.{{key}}"
              value="{{lookup ../system.skills key}}"
              data-dtype="Number"
              min="{{../skillMin}}"
              max="{{../skillMax}}"
              step="1"
            />
          </div>
        {{/each}}
      </div>

      <p class="notes small" style="margin-top:6px;">
        Tirada: d100 &lt; valor (Normal) · d100 &lt; ceil(valor/2) (Crítica).
      </p>
    </div>

<!-- ===== TAB: Movimientos ===== -->
<div class="tab" data-tab="moves" data-group="primary">
  <div class="flexrow" style="justify-content: space-between; align-items: center; margin-bottom: 6px;">
    <h3 style="margin:0;">Movimientos</h3>
    <button type="button" data-action="create-move">+ Nuevo movimiento</button>
  </div>

  {{#if moves.length}}
    <ol class="item-list">
      <li class="item item-header flexrow">
        <div class="item-name">Nombre</div>
        <div class="item-prop">Tipo</div>
        <div class="item-prop">Cat.</div>
        <div class="item-prop">Prec.</div>
        <div class="item-prop">PP</div>
        <div class="item-prop">Daño</div>
        <div class="item-prop">Rango</div>
        <div class="item-controls"></div>
      </li>

      {{#each moves as |m|}}
        <li class="item flexrow" data-item-id="{{m.id}}">
          <div class="item-name"><a data-action="edit-move">{{m.name}}</a></div>
          <div class="item-prop">{{m.system.element}}</div>

          <!-- Cat.: Fís / Esp / Estado -->
          <div class="item-prop">
            {{#if (eq m.system.category "special")}}
              Esp
            {{else}}
              {{#if (eq m.system.category "status")}}
                Estado
              {{else}}
                Fís
              {{/if}}
            {{/if}}
          </div>

          <div class="item-prop">{{m.system.accuracy}}</div>
          <div class="item-prop">{{m.system.pp.value}}/{{m.system.pp.max}}</div>
          <div class="item-prop">{{m.system.baseDamage}}</div>
          <div class="item-prop">{{m.system.range}}</div>
          <div class="item-controls">
            <button type="button" class="as-link" data-action="use-move" title="Usar">Usar</button>
            <a data-action="edit-move" title="Editar"><i class="fas fa-edit"></i></a>
            <a data-action="delete-move" title="Eliminar"><i class="fas fa-trash"></i></a>
          </div>
        </li>

        {{#if m.system.effect}}
          <li class="item item-summary">
            <div class="item-effect">{{m.system.effect}}</div>
          </li>
        {{/if}}
      {{/each}}
    </ol>
  {{else}}
    <p class="notes">Arrastra Items tipo <b>Movimiento</b> o usa “+ Nuevo movimiento”.</p>
  {{/if}}
</div>

    <!-- ===== TAB: Rasgos ===== -->
    <div class="tab" data-tab="traits" data-group="primary">
      <div class="flexrow" style="justify-content: space-between; align-items: center; margin-bottom: 6px;">
        <h3 style="margin:0;">Rasgos</h3>
        <button type="button" data-action="create-item" data-type="trait">+ Nuevo rasgo</button>
      </div>

      {{#if traits.length}}
        <ol class="item-list">
          <li class="item item-header flexrow">
            <div class="item-name">Nombre</div>
            <div class="item-prop notes">Efecto</div>
            <div class="item-controls"></div>
          </li>

          {{#each traits as |trait|}}
            <li class="item flexrow" data-item-id="{{trait.id}}">
              <div class="item-name"><a data-action="edit-item">{{trait.name}}</a></div>
              <div class="item-prop notes">
                {{#if trait.system.effect}}
                  {{trait.system.effect}}
                {{else}}
                  —
                {{/if}}
              </div>
              <div class="item-controls">
                <a data-action="edit-item" title="Editar"><i class="fas fa-edit"></i></a>
                <a data-action="delete-item" title="Eliminar"><i class="fas fa-trash"></i></a>
              </div>
            </li>
          {{/each}}
        </ol>
      {{else}}
        <p class="notes">Añade rasgos para registrar efectos especiales o talentos del personaje.</p>
      {{/if}}
    </div>

<!-- ===== TAB: Objetos ===== -->
<div class="tab" data-tab="inventory" data-group="primary">
  {{#each inventorySections as |section|}}
    <div class="inventory-section">
      <div class="flexrow" style="justify-content: space-between; align-items: center; margin: 12px 0 6px;">
        <h3 style="margin:0;">{{section.label}}</h3>
        <button type="button" data-action="create-item" data-type="{{section.type}}">{{section.createLabel}}</button>
      </div>

      {{#if section.items.length}}
        {{#if (eq section.type "equipment")}}
          <ol class="item-list">
            <li class="item item-header flexrow">
              <div class="item-name">Nombre</div>
              <div class="item-prop">Valor</div>
              <div class="item-prop notes">Efecto</div>
              <div class="item-controls"></div>
            </li>

            {{#each section.items as |item|}}
              <li class="item flexrow" data-item-id="{{item.id}}">
                <div class="item-name"><a data-action="edit-item">{{item.name}}</a></div>
                <div class="item-prop">{{item.system.value}}</div>
                <div class="item-prop notes">
                  {{#if item.system.effect}}
                    {{item.system.effect}}
                  {{else}}
                    —
                  {{/if}}
                </div>
                <div class="item-controls">
                  <a data-action="edit-item" title="Editar"><i class="fas fa-edit"></i></a>
                  <a data-action="delete-item" title="Eliminar"><i class="fas fa-trash"></i></a>
                </div>
              </li>
            {{/each}}
          </ol>
        {{else}}
          {{#if (eq section.type "consumable")}}
            <ol class="item-list">
              <li class="item item-header flexrow">
                <div class="item-name">Nombre</div>
                <div class="item-prop">Cant.</div>
                <div class="item-prop">Valor</div>
                <div class="item-prop notes">Efecto</div>
                <div class="item-controls"></div>
              </li>

              {{#each section.items as |item|}}
                <li class="item flexrow" data-item-id="{{item.id}}">
                  <div class="item-name">
                    <button type="button" class="as-link" data-action="use-consumable">{{item.name}}</button>
                  </div>
                  <div class="item-prop">{{item.system.quantity}}</div>
                  <div class="item-prop">{{item.system.value}}</div>
                  <div class="item-prop notes">
                    {{#if item.system.effect}}
                      {{item.system.effect}}
                    {{else}}
                      —
                    {{/if}}
                  </div>
                  <div class="item-controls">
                    <a data-action="edit-item" title="Editar"><i class="fas fa-edit"></i></a>
                    <a data-action="delete-item" title="Eliminar"><i class="fas fa-trash"></i></a>
                  </div>
                </li>
              {{/each}}
            </ol>
          {{else}}
            <ol class="item-list">
              <li class="item item-header flexrow">
                <div class="item-name">Nombre</div>
                <div class="item-prop">Cant.</div>
                <div class="item-prop">Valor</div>
                <div class="item-controls"></div>
              </li>

              {{#each section.items as |item|}}
                <li class="item flexrow" data-item-id="{{item.id}}">
                  <div class="item-name">
                    <button type="button" class="as-link" data-action="use-gear">{{item.name}}</button>
                  </div>
                  <div class="item-prop">{{item.system.quantity}}</div>
                  <div class="item-prop">{{item.system.value}}</div>
                  <div class="item-controls">
                    <a data-action="edit-item" title="Editar"><i class="fas fa-edit"></i></a>
                    <a data-action="delete-item" title="Eliminar"><i class="fas fa-trash"></i></a>
                  </div>
                </li>

                {{#if item.system.description}}
                  <li class="item item-summary">
                    <div class="item-effect"><strong>Descripción:</strong> {{item.system.description}}</div>
                  </li>
                {{/if}}
              {{/each}}
            </ol>
          {{/if}}
        {{/if}}
      {{else}}
        <p class="notes">{{section.emptyHint}}</p>
      {{/if}}
    </div>
  {{/each}}
</div>
  </section>
</form>
