<form class="{{cssClass}} my-item-sheet" autocomplete="off">
  <header class="sheet-header flexrow">
    <div class="header-fields">
      <label>Nombre del objeto</label>
      <input type="text" name="name" value="{{item.name}}"/>
    </div>
  </header>

  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="details">Detalles</a>
    <a class="item" data-tab="description">Descripción</a>
    {{#if isConsumable}}
      <a class="item" data-tab="permanent">Efecto permanente</a>
    {{/if}}
    {{#if isGM}}
      <a class="item" data-tab="gm">Privado</a>
    {{/if}}
    <a class="item" data-tab="effects">Efectos</a>
  </nav>

  <section class="sheet-body">
    <div class="tab" data-tab="details" data-group="primary">
      <div class="grid two-col">
        {{#if (or isConsumable isGear)}}
          <div class="field">
            <label>Cantidad</label>
            <input type="number" name="system.quantity" value="{{system.quantity}}" data-dtype="Number" min="0"/>
          </div>
        {{/if}}

        {{#if (or isConsumable isGear isEquipment)}}
          <div class="field">
            <label>Valor</label>
            <input type="number" name="system.value" value="{{system.value}}" data-dtype="Number" min="0" step="1"/>
          </div>
        {{/if}}

        {{#if (or isEquipment isConsumable)}}
          <div class="field">
            <label>Equipado</label>
            <input type="checkbox" name="system.equipped" {{checked system.equipped}} />
          </div>
        {{/if}}

        {{#if isTrait}}
          <div class="field full-width">
            <p class="notes">Los rasgos solo requieren un nombre y su efecto.</p>
          </div>
        {{/if}}
      </div>
    </div>

    <div class="tab" data-tab="description" data-group="primary">
      {{#if isGear}}
        <div class="field">
          <label>Descripción</label>
          <textarea name="system.description" rows="5">{{system.description}}</textarea>
        </div>
      {{/if}}

      {{#if (or isConsumable isEquipment isTrait)}}
        <div class="field">
          <label>Efecto</label>
          <textarea name="system.effect" rows="5">{{system.effect}}</textarea>
        </div>
      {{/if}}
    </div>

    {{#if isGM}}
      <div class="tab" data-tab="gm" data-group="primary">
        <div class="field">
          <label>¿Es trampa?</label>
          <input
            type="checkbox"
            name="system.trap.enabled"
            {{checked system.trap.enabled}}
            data-toggle-target=".trap-details"
          />
        </div>

        <div
          class="field trap-details"
          style="{{#unless system.trap.enabled}}display: none;{{/unless}}"
        >
          <label>Descripción oculta</label>
          <textarea name="system.trap.description" rows="5">{{system.trap.description}}</textarea>
        </div>

        <p
          class="notes trap-details"
          style="{{#unless system.trap.enabled}}display: none;{{/unless}}"
        >
          Esta descripción reemplazará a la normal al usarse el objeto.
        </p>
      </div>
    {{/if}}

    {{#if isConsumable}}
      <div class="tab" data-tab="permanent" data-group="primary">
        <div class="field permanent-effects-header">
          <label>Efectos permanentes</label>
          <button type="button" class="permanent-effect-add" title="Añadir efecto permanente" aria-label="Añadir efecto permanente">+</button>
        </div>

        <div class="permanent-effects-list">
          {{#each permanentEffects as |effect|}}
            <div class="grid two-col permanent-effect-row">
              <div class="field">
                <label>Atributo</label>
                <select name="system.permanentEffects.{{@index}}.attribute">
                  {{#each ../consumablePermanentAttributes as |option|}}
                    <option value="{{option.key}}" {{#if (eq option.key effect.attribute)}}selected{{/if}}>
                      {{option.label}}
                    </option>
                  {{/each}}
                </select>
              </div>

              <div class="field">
                <label>Modo</label>
                <select name="system.permanentEffects.{{@index}}.mode">
                  <option value="add" {{#if (eq effect.mode "add")}}selected{{/if}}>Sumar</option>
                  <option value="subtract" {{#if (eq effect.mode "subtract")}}selected{{/if}}>Restar</option>
                </select>
              </div>

              <div class="field">
                <label>Cantidad</label>
                <input
                  type="number"
                  name="system.permanentEffects.{{@index}}.amount"
                  value="{{effect.amount}}"
                  data-dtype="Number"
                  min="0"
                />
              </div>

              <div class="permanent-effect-actions">
                <button
                  type="button"
                  class="permanent-effect-remove"
                  data-index="{{@index}}"
                  title="Eliminar efecto permanente"
                  aria-label="Eliminar efecto permanente"
                >
                  −
                </button>
              </div>
            </div>
          {{/each}}
        </div>

        <p class="notes">Este cambio se aplicará cuando se utilice el consumible.</p>
      </div>
    {{/if}}

    <div class="tab" data-tab="effects" data-group="primary">
      {{> systems/PMD-Explorers-of-Fate/templates/parts/active-effects.hbs effects=activeEffects scope="item" editable=editable}}
    </div>
  </section>
</form>
